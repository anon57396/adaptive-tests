name: Welcome New Contributors

on:
  pull_request_target:
    types: [opened]
  issues:
    types: [opened]

jobs:
  welcome:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    steps:
      - name: Welcome First Time Contributors
        uses: actions/github-script@v8
        with:
          script: |
            const actor = context.payload.sender.login;
            const repo = context.repo;
            const issue = context.payload.issue;
            const pr = context.payload.pull_request;

            // Check if this is their first contribution
            const issues = await github.rest.issues.listForRepo({
              ...repo,
              creator: actor,
              state: 'all'
            });

            if (issues.data.length === 1) {
              const isIssue = !!issue;
              const isPR = !!pr;
              const issueNumber = isIssue ? issue.number : pr.number;

              const welcomeMessage = isPR
                ? `## 🎉 Welcome @${actor}!\n\nThank you for your first pull request to Adaptive Tests! We're excited to have you contributing.\n\n### What happens next?\n- A maintainer will review your PR soon\n- CI checks will run automatically\n- Feel free to ask questions if you need help\n\n### Resources\n- 📖 [Contributing Guide](https://github.com/anon57396/adaptive-tests/blob/main/CONTRIBUTING.md)\n- 💬 [Join the discussion](https://github.com/anon57396/adaptive-tests/discussions)\n- 📚 [Documentation](https://anon57396.github.io/adaptive-tests/)`
                : `## 👋 Welcome @${actor}!\n\nThank you for opening your first issue in Adaptive Tests! We appreciate you taking the time to report this.\n\n### What happens next?\n- A maintainer will review and label your issue\n- We'll ask for more details if needed\n- Feel free to check out our [contributing guide](https://github.com/anon57396/adaptive-tests/blob/main/CONTRIBUTING.md)\n\n### Get Involved\n- 💬 [Join discussions](https://github.com/anon57396/adaptive-tests/discussions)\n- 🐛 [See other issues](https://github.com/anon57396/adaptive-tests/issues)\n- 📚 [Read the docs](https://anon57396.github.io/adaptive-tests/)`;

              await github.rest.issues.createComment({
                ...repo,
                issue_number: issueNumber,
                body: welcomeMessage
              });

              // Add labels
              if (isPR) {
                await github.rest.issues.addLabels({
                  ...repo,
                  issue_number: issueNumber,
                  labels: ['first-pr', 'needs-review']
                });
              } else {
                await github.rest.issues.addLabels({
                  ...repo,
                  issue_number: issueNumber,
                  labels: ['needs-triage']
                });
              }
            }